How to add indexes to your datastore tables
============================================
.. _guide_indexes:

To improve the performance of datastore queries, you should add indexes.

Indexes can be defined within the data dictionary form, or via the API.
You must first define any column you want to index under Dictionary Fields.
Then under Dictionary Indexes, you will list the field, a length (default is 50),
the index type (index, or fulltext), and a description for reference.

Any time the datastore is updated, the data dictionary definitions will be reapplied when the post_import queue runs.

API
---

In the example below we are defining two fields, and adding a standard index for the first field and a fulltext index for the second.

.. sourcecode:: http

    POST http://mydomain.com/api/1/metastore/schemas/data-dictionary/items HTTP/1.1
    Authorization: Basic username:password

    {
        "title": "sample indexes",
        "data": {
            "fields": [
                {
                    "name": "sample_id",
                    "title": "ID",
                    "type": "integer"
                },
                {
                    "name": "description",
                    "title": "Description",
                    "type": "string"
                }
            ],
            "indexes": [
                {
                  "fields": [
                    {
                      "name": "sample_id",
                      "length": 15
                    }
                  ],
                  "type": "index",
                  "description": "idx1"
                },
                {
                  "fields": [
                    {
                      "name": "description"
                    }
                  ],
                  "type": "fulltext",
                  "description": "idx2"
                }
            ]
        }
    }

GUI
---

As an alternative to creating Data Dictionary Indexes through the API, you may choose to use the graphical user interface (GUI).
The GUI can be used to create both Data Dictionary Fields and Indexes. See below for how to create Indexes. For more information on how to add data dictionary fields please see :doc:`guide_data_dictionaries`.

Prerequisites
^^^^^^^^^^^^^
  1. Log in as an administrator.
  2. From the DKAN menu, select Data Dictionary -> Create.
  3. There are certain form elements that apply to all Data Dictionaries, they are as follows:

    1. Identifier: This is a UUID and is autogenerated for each Data Dictionary.
    2. Title: Enter a name for your data dictionary here.

  4. After completing the above two required fields, move to the Data Dictionary Fields section and complete it, referencing :doc:`guide_data_dictionaries` if needed. Please note that any column you want to index below must be defined in the ‘Data Dictionary Fields’ section (see step 2.1 in the ‘Index Fields’ section below for reference).
  5. After defining the fields, move to the ‘Indexes’ section.

Indexes
^^^^^^^
  1. Click "Add index".
  2. An editable "Index" form box will appear. Complete the required form fields here:

    1. Name: Enter a description of the index's purpose or functionality here.
    2. Index Type:

      1. index
      2. fulltext

  3. After defining the index, move to the ‘Index Fields’ section. Please note that an index requires at least one index field and that index field must be defined in the ‘Data Dictionary Fields’ section.

Index Fields
^^^^^^^^^^^^
  1. To add an index field, click "Add field" under the ‘Fields’ section within the respective ‘Index’ section.
  2. An editable "Add new field" form box will appear. Complete the required form fields here:

    1. Name: Enter a name, this must be a key from the dictionary fields object as created previously (see step 4 in the ‘Prerequisites’ section above for reference).
    2. Length: how many characters long this field can be.

  3. Click "Add" to save the field temporarily. Remember that the Data Dictionary and it's respective fields and indexes are not completely saved until the form is submitted by clicking "Save".
  4. Alternatively you can click "Cancel" to stop creating the index field, at which point all the information you entered will be removed and the editable "Add new field" form box will close.
  5. Note that after saving an index field, an informational table will appear listing the index fields you have created thus far and their names and length.

    1. You also have the ability to edit or modify the fields you've created so far by clicking the gear icon on the right-hand side of this table.
    2. Clicking the gear icon will open an editable form that will show the previously entered information for the respective index field. You can then modify this information and either: "Save Index Field" (retain the modifications), "Cancel Index Field" (close the editable form box without retaining any modifications) or "Delete Index Field" (remove the respective index field entirely).

  6. You can enter additional index fields by clicking "Add field" (in this index section) again and repeating steps 2-3.
  7. After defining the index fields, click "Submit Index" to save the index temporarily. Remember that the Data Dictionary and it's respective fields and indexes are not completely saved until the form is submitted by clicking "Save".
  8. Note that after submitting, an informational table will appear listing the indexes you have created thus far and their names, types, and fields (field name and field length).

    1. You also have the ability to edit or modify the indexes you've created so far by clicking the gear icon on the right-hand side of this table.
    2. Clicking the gear icon will open an editable form that will show the previously entered information for the respective index. You can then modify this information and either: "Save" (retain the modifications), "Cancel Index" (close the editable form box without retaining any modifications) or "Delete Index" (remove the respective index entirely).

      1. Note here that it is not possible to modify index fields in this manner at this time. If you must change an index field, the current work around is to delete the associated index entirely and re-create it and it's fields again.

  9. Finally, make sure you click "Save" and then "Yes" to "Are you sure you want to publish this item?" in order to submit the form in it's entirety, saving the data dictionary.
  10. See a list of your data dictionaries at `/api/1/metastore/schemas/data-dictionary/items/`
  11. Edit your data dictionary by going to `/admin/dkan/data-dictionaries`.
  12. Click the "Edit" link in the right-hand column next to the data dictionary you want to edit.



