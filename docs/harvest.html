<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DKAN: Harvest</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="all.min.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <img alt="Logo" src="logo.svg"/>
  </div>
  <!-- <div id="projectname">DKAN</div> -->
  <div id="projectdetails">
    <span id="projectbrief">Alpha</span>
    <span id="projectnumber">v2.0.2</span>
  </div>
  <div id="search">
            <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('harvest.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Harvest </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To “harvest” data is to use the public feed or API of another data portal to import items from that portal’s catalog into your own. For example, <a href="https://data.gov/">Data.gov</a> harvests all of its datasets from the <a href="https://project-open-data.cio.gov/v1.1/schema/">data.json</a> files of <a href="https://catalog.data.gov/harvest">hundreds of U.S. federal, state and local data portals</a>.</p>
<p>DKAN Harvest uses the local file system to store source information in cache and plan files.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Drush Commands</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command  </th><th class="markdownTableHeadNone">Args  </th><th class="markdownTableHeadNone">Notes   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dkan-harvest:list  </td><td class="markdownTableBodyNone">n/a  </td><td class="markdownTableBodyNone">Lists avaialble harvests.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dkan-harvest:register  </td><td class="markdownTableBodyNone">$config  </td><td class="markdownTableBodyNone">Register a new harvest, file saved to <em>dkan_harvest/plans</em> directory.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dkan-harvest:deregister  </td><td class="markdownTableBodyNone">$identifier  </td><td class="markdownTableBodyNone">Deletes the cached plan file.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dkan-harvest:cache  </td><td class="markdownTableBodyNone">$identifier  </td><td class="markdownTableBodyNone">This will fetch the source data, apply the source configuration and cache the data to a local file.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dkan-harvest:run  </td><td class="markdownTableBodyNone">$identifier  </td><td class="markdownTableBodyNone">This will harvest the current cache for the selected sources.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dkan-harvest:revert  </td><td class="markdownTableBodyNone">$identifier  </td><td class="markdownTableBodyNone">Reverts harvest.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md44"></a>
Setup</h2>
<p>Currently there is no UI for the harvests, use the drush commands above to harvest data:</p>
<p>To register a new harvest source, pass in the config argument as JSON:</p>
<div class="fragment"><div class="line">dkan-harvest:register &#39;{&quot;identifier&quot;:&quot;dkandemo&quot;,&quot;source&quot;:{&quot;type&quot;:&quot;\\Harvest\\ETL\\Extract\\DataJson&quot;,&quot;uri&quot;:&quot;http:\/\/demo.getdkan.com\/data.json&quot;},&quot;transforms&quot;:[{&quot;Filter&quot;:{&quot;keyword&quot;:&quot;environment&quot;}},{&quot;Override&quot;:{&quot;publisher.name&quot;:&quot;DKAN Demo&quot;}},&quot;\\Drupal\\dkan_harvest\\Transform\\DataJsonToDkan&quot;],&quot;load&quot;:{&quot;type&quot;:&quot;\\Drupal\\dkan_harvest\\Load\\Dataset&quot;}}&#39;</div>
</div><!-- fragment --><p>That source config looks like:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;identifier&quot;: &quot;dkandemo&quot;,</div>
<div class="line">  &quot;source&quot;: {</div>
<div class="line">    &quot;type&quot;: &quot;\\Harvest\\Extract\\DataJson&quot;,</div>
<div class="line">    &quot;uri&quot;: &quot;http:\/\/demo.getdkan.com\/data.json&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;transforms&quot;: [</div>
<div class="line">    &quot;\\Drupal\\dkan_harvest\\Transform\\DataJsonToDkan&quot;</div>
<div class="line">  ],</div>
<div class="line">  &quot;load&quot;: {</div>
<div class="line">    &quot;type&quot;: &quot;\\Drupal\\dkan_harvest\\Load\\Dataset&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>About the load configs <pre class="fragment">* **identifier**: The plan's identifier. Required.
* **source**: Required.

  - **type**: Class utilized to extract the data from the source. Required.
  - **uri**: The URL or Location of the Source. Required.

* **transforms**:

  - **type**: Class utilized to transform the data OR null.

* **load**: Required.

  - **type**: Class utilized to load the harvested data. Required.
</pre></dd></dl>
<p>Project Open Data (as well as most metadata APIs) includes many fields that are not simple key-value pairs. If you need to access or modify nested array values you can use this dot syntax to specify the path: <code>key.nested_key.0.other_nested_key</code>. For example, the Publisher field in Project Open Data is expressed like this:</p>
<div class="fragment"><div class="line">&quot;publisher&quot;: {</div>
<div class="line">  &quot;@type&quot;: &quot;org:Organization&quot;,</div>
<div class="line">  &quot;name&quot;: &quot;demo.getdkan.com&quot;</div>
<div class="line">},</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
Transforms</h2>
<p>The transform classes will help you fine tune the results of your harvest.</p>
<p>:Filters: Filters restrict the datasets imported by a particular field. For instance, if you are harvesting a data.json source and want only to harvest health-related datasets, you might add a filter with "keyword" in the first text box, and "heatlh" in the second. :Excludes: Excludes are the inverse of filters. For example, if you know there is one publisher listed on the source whose datasets you do <b>not</b> want to bring into your data portal, you might add "publisher.name" with value "Governor's Office of Untidy Data" :Overrides: Overrides will replace values from the source when you harvest. For instance, if you want to take responsibility for the datasets once harvested and add your agency's name as the publisher, you might add "publisher.name" with your agency's name as the value. :Defaults: Defaults work the same as overrides, but will only be used if the relevant field is empty in the source </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
