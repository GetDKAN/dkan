<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DKAN: Datastore</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script src="https://kit.fontawesome.com/4f4525663e.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <img alt="Logo" src="logo.svg"/>
  </div>
  <!-- <div id="projectname">DKAN</div> -->
  <div id="projectdetails">
    <span id="projectbrief">Open Data Catalog</span>
    <span id="projectnumber">v2.0.0</span>
  </div>
  <div id="search">
            <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('datastore.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Datastore </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The DKAN <b>Datastore</b> module provides integration with the <a href="https://github.com/GetDKAN/datastore">datastore</a> library. With it you are able to parse CSV files and save the data in database tables. This allows users to query the data through a public API. Note that the CSV must be in UTF-8 format to parse correctly.</p>
<p>When a dataset is added to the catalog, the mimetype value of each distribution object is checked to determine if the distribution is a CSV file or not. CSV distributions will be added to the import queue to be parsed and imported into the datastore.</p>
<p>The import will happen in batches during cron runs. The import will itterate over the file, if it does not finish, the job will be returned to the queue. Be sure to have cron running on a regular basis so that large file imports will complete. If there is a change to the metadata it will trigger a new import to the datastore.</p>
<p>You can manually import file data into the datastore via drush with the identifier of the distribution. Use the <a href="guide-dataset-api.html#identifiers">API</a> to get the identifier of the file you want to import.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Drush Commands</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command </th><th class="markdownTableHeadNone">Args </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dkan-datastore:import </td><td class="markdownTableBodyNone">$uuid </td><td class="markdownTableBodyNone">import file to the datastore  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dkan-datastore:drop </td><td class="markdownTableBodyNone">$uuid </td><td class="markdownTableBodyNone">drop the datastore table  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">queue:run </td><td class="markdownTableBodyNone">dkan_datastore_import </td><td class="markdownTableBodyNone">process all of the datastore import jobs  </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md10"></a>
Datastore API</h3>
<p>Your data is now available via the Datastore API! <code>api/1/datastore/sql?query=</code></p>
<p><b>Parameters</b></p><ul>
<li>resource_identifier (mixed) – identifier of the resource to be searched against</li>
<li>properties (mixed) – array or string of matching conditions to select</li>
<li>conditions (string) - retrieve only objects with properties of certain values</li>
<li>sort (string) – comma separated field names with ordering</li>
<li>order (string) – comma separated field names</li>
<li>limit (int) – maximum number of rows to return</li>
<li>offset (int) – offset this number of rows</li>
<li>count (boolean) - mark query as a count query</li>
</ul>
<p><b>Example</b></p>
<div class="fragment"><div class="line">http://domain.com/api/1/datastore/sql?query=[SELECT * FROM ${resource_identifier}][WHERE state = &#39;OK&#39;][ORDER BY county ASC][LIMIT 5 OFFSET 100]</div>
</div><!-- fragment --><p>The <b>dkan_datastore</b> module provides integration with the <a href="https://github.com/GetDKAN/datastore">datastore</a> library. With it you are able to parse CSV files and save the data in database tables. This allows users to query the data through a public API. Note that the CSV must be in UTF-8 format to parse correctly.</p>
<p>When a dataset is added to the catalog, the mimetype value of each distribution object is checked to determine if the distribution is a CSV file or not. CSV distributions will be added to the import queue to be parsed and imported into the datastore.</p>
<p>The import will happen in batches during cron runs. The import will itterate over the file, if it does not finish, the job will be returned to the queue. Be sure to have cron running on a regular basis so that large file imports will complete. If there is a change to the metadata it will trigger a new import to the datastore.</p>
<p>You can manually import file data into the datastore via drush with the identifier of the distribution. Use the <a href="guide-dataset-api.html#identifiers">API</a> to get the identifier of the file you want to import.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Drush Commands</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command </th><th class="markdownTableHeadNone">Args </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dkan-datastore:import </td><td class="markdownTableBodyNone">$uuid </td><td class="markdownTableBodyNone">import file to the datastore  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dkan-datastore:drop </td><td class="markdownTableBodyNone">$uuid </td><td class="markdownTableBodyNone">drop the datastore table  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">queue:run </td><td class="markdownTableBodyNone">dkan_datastore_import </td><td class="markdownTableBodyNone">process all of the datastore import jobs  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md34"></a>
Datastore API</h2>
<p>Your data is now available via the Datastore API!</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Parameters</h3>
<ul>
<li>resource_identifier (mixed) – identifier of the resource to be searched against</li>
<li>properties (mixed) – array or string of matching conditions to select</li>
<li>conditions (string) - retrieve only objects with properties of certain values</li>
<li>sort (string) – comma separated field names with ordering</li>
<li>order (string) – comma separated field names</li>
<li>limit (int) – maximum number of rows to return</li>
<li>offset (int) – offset this number of rows</li>
<li>count (boolean) - mark query as a count query</li>
</ul>
<h3><a class="anchor" id="autotoc_md36"></a>
Example</h3>
<div class="fragment"><div class="line">http://domain.com/api/1/datastore/sql?query=[SELECT * FROM ${resource_identifier}][WHERE state = &#39;OK&#39;][ORDER BY county ASC][LIMIT 5 OFFSET 100]</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
